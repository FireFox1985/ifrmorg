<% if @triggers.exists? %>
	<% @triggers.all.each do |item| %>
		<% if item.viewers.include?(current_user.id.to_s) || (current_user.id == @profile.id && !item.viewers.empty?) %>
			<div class="profile">
				<h1 class="profile_name"><%= link_to item.name, item %></h1>
				<strong>
			      <% if item.category.count == 1 %>
			        Category:
			      <% else %>
			        Categories:
			      <% end %>
			    </strong>
				<% item.category.each do |category_item| %>
      				<%= fetch_categories_moods(item, "trigger", category_item, "category", true) %>
    			<% end %>
    			<br />
    			<strong>
			      <% if item.mood.count == 1 %>
			        Mood:
			      <% else %>
			        Moods:
			      <% end %>
			    </strong>
				<% item.mood.each do |mood_item| %>
      				<%= fetch_categories_moods(item, "trigger", mood_item, "mood", true) %>
    			<% end %>
			</div>
		<% end %>
	<% end %>
<% end %>

<% if @profile.id != current_user.id %>
	 <% if Ally.where(:userid => current_user.id).exists? && Ally.where(:userid => current_user.id).first.allies.include?(@profile.id.to_s) && (!Ally.where(:userid => @profile.id).exists? || !Ally.where(:userid => @profile.id).first.allies.include?(current_user.id.to_s)) %>
	 	<br /><%= link_to 'Cancel Request', remove_allies_path(:userid => @profile.id), :method => :post, data: { confirm: 'Are you sure?' } %> 
	<% elsif Ally.where(:userid => @profile.id).exists? && Ally.where(:userid => @profile.id).first.allies.include?(current_user.id.to_s) && Ally.where(:userid => current_user.id).first.allies.include?(@profile.id.to_s) %>
		<br /><%= link_to 'Remove as Ally', remove_allies_path(:userid => @profile.id), :method => :post, data: { confirm: 'Are you sure?' } %>
	<% elsif (!Ally.where(:userid => current_user.id).exists? || !Ally.where(:userid => current_user.id).first.allies.include?(@profile.id.to_s)) && (!Ally.where(:userid => @profile.id).exists? || !Ally.where(:userid => @profile.id).first.allies.include?(current_user.id.to_s)) %>
		<br /><%= link_to 'Add to Allies', add_allies_path(:userid => @profile.id), :method => :post %> 
	<% else %>
		<br /><%= link_to 'Accept', add_allies_path(:userid => @profile.id), :method => :post %>
	<% end %>
<% end %>

